<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>1022面试题 | 北川的个人博客</title><meta name="keywords" content="每日面试"><meta name="author" content="北川,1656473414@qq.com"><meta name="copyright" content="北川"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="1022面试题"><meta name="application-name" content="1022面试题"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="1022面试题"><meta property="og:url" content="https://gukeyang.github.io/posts/69be1e2f.html"><meta property="og:site_name" content="北川的个人博客"><meta property="og:description" content="每日面试题1.索引哪些情况会失效?常见的失效场景：    情况 说明    1. 使用 or 连接不同字段 如果 or 两边有一个字段无索引，会导致全表扫描。   2. 对索引列使用函数或计算 如 where length(name)&amp;#x3D;3、where age+1&amp;#x3D;10。   3. 使用 % 开头的模"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://s2.loli.net/2025/10/23/pH7DOX5rqdLCk4b.jpg?_r_=a6fd3437-28f4-cb41-7271-bc60ac64be0a"><meta property="article:author" content="北川"><meta property="article:tag" content="博客,笔记,学习"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2025/10/23/pH7DOX5rqdLCk4b.jpg?_r_=a6fd3437-28f4-cb41-7271-bc60ac64be0a"><meta name="description" content="每日面试题1.索引哪些情况会失效?常见的失效场景：    情况 说明    1. 使用 or 连接不同字段 如果 or 两边有一个字段无索引，会导致全表扫描。   2. 对索引列使用函数或计算 如 where length(name)&amp;#x3D;3、where age+1&amp;#x3D;10。   3. 使用 % 开头的模"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://gukeyang.github.io/posts/69be1e2f"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":"3932F24FA213E964B6B1B0FD091F88CE"},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://friends.anheyu.com/"},
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🔨 设计开发一条龙","🏃 脚踏实地行动派"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: 北川","link":"链接: ","source":"来源: 北川的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '北川的个人博客',
  title: '1022面试题',
  postAI: '',
  pageFillDescription: '每日面试题, 1.索引哪些情况会失效?, 通过 EXPLAIN 判断索引是否有效：关注 type 字段, 覆盖索引：避免回表优化查询效率, 索引下推（ICPIndex Condition Pushdown）：减少回表次数, 2.final、finalize、finally三者的不同?, 3.java中深拷贝和浅拷贝?, 1. 浅拷贝（Shallow Copy）, 定义：, 实现方式：, 2. 深拷贝（Deep Copy）, 定义：, 实现方式：, 4.谈一下你对MyBatis的认识?, 缓存机制, 核心组件, ⚙️ 原理：, MyBatis 整体架构, MyBatis 工作原理, MyBatis 缓存原理, 5.动态SQL的作用和原理, 一、动态 SQL 的作用, 原理总结, 6.get和post的区别?, 7.spring拦截器的执行顺序?, ✅ 执行流程：, ✅ 顺序规则：, 1. 拦截器（Interceptor）, 1.1. 概念, 1.2. 工作时机, 1.3. 执行顺序, 1.4. 实现方式, 1.5. 应用场景, 2. 过滤器（Filter）, 2.1. 概念, 2.2. 工作时机, 2.3. 执行顺序, 2.4. 实现方式, 拦截器与过滤器的区别, 8.后端验证注解?, @Valid 和 @Validated, 常见的 Spring 配置, 启用全局验证, 全局异常处理, 9.如何保证消息的可靠性, ✅ 核心思路：, 幂等性保证, 幂等性定义, 实现幂等性, 监控与报警, 10.模糊查询的like怎么写?, 11.Spring 的7种事务传播行为, 12.@Transactional 5个属性, 13.为什么需要预编译, ❌ 非预编译方式（Statement）：, ✅ 优点：, 14.MQ 有哪些使用场景?(掌握), 为什么需要 MQ（解决什么问题）, 1️⃣ 解耦（Decoupling）, 2️⃣ 异步（Asynchronous）, 3️⃣ 削峰（Peak Shaving）, 项目实践（结合经验）每日面试题索引哪些情况会失效常见的失效场景情况说明使用连接不同字段如果两边有一个字段无索引会导致全表扫描对索引列使用函数或计算如使用开头的模糊匹配不能走索引而可以字符串类型未加引号导致隐式类型转换不符合最左前缀原则复合索引只查询不会用上使用通常会导致放弃索引索引字段参与比较但列类型不匹配比如和比较数据分布不均匀当索引列的数据分布极度不均匀时索引的效果会大打折扣索引字段为值当查询条件涉及索引列的值时无法使用索引来定位值进行全表扫描通过判断索引是否有效关注字段结果中的字段表示表的连接类型直接反映了索引的使用效率从优到劣的常见类型如下表中只有一行数据如系统表是的特例效率最高通过主键或唯一索引查询最多返回一行数据如效率极高多表连接时被连接表通过主键或唯一索引匹配每行只匹配一次如主键非唯一索引匹配可能返回多行如是普通索引效率较高索引范围扫描如或只扫描索引的某一段效率优于全表扫描扫描整个索引树如且有索引虽扫描全部索引但索引通常比数据小效率优于全表扫描全表扫描未使用索引效率最低需优先优化结论为时说明索引被有效使用效率依次降低若为则表示未使用索引需检查索引设计或语句覆盖索引避免回表优化查询效率覆盖索引是指查询所需的字段后的列全部包含在某一索引中此时无需访问表数据仅通过索引即可返回结果避免了回表从索引树找到主键后再去聚簇索引查完整数据显著提升效率识别覆盖索引时字段会显示索引下推减少回表次数引入的索引下推优化用于在索引扫描过程中提前过滤不符合条件的记录减少回表次数原理在没有时存储引擎通过索引找到符合或条件的主键后会先回表获取完整数据再由服务器层过滤其他条件有时存储引擎在索引扫描阶段会同时判断索引中包含的其他条件如联合索引中的非前缀列直接过滤掉不符合条件的记录仅对剩余记录回表减少回表次数识别触发时字段会显示三者的不同关键字用途特点修饰类方法变量类不可继承方法不可重写变量不可修改类方法前回调一次已过时后废弃异常处理结构保证一定执行除非对象引用不可变但内部属性可变当用修饰一个对象变量时这个变量引用一旦指向某个对象就不能再指向其他对象即引用的内存地址不可变但对象本身在内存中的数据属性是可以被修改的中深拷贝和浅拷贝在中拷贝指创建一个对象的副本根据副本对象与原对象的依赖关系分为浅拷贝和深拷贝核心区别在于是否拷贝对象内部的引用类型成员浅拷贝定义只拷贝对象本身基本类型成员直接复制值但对于对象内部的引用类型成员仅拷贝其引用地址即副本与原对象共享同一个引用类型成员的实例实现方式让类实现接口标记接口无实际方法重写类的方法默认返回浅拷贝对象深拷贝定义不仅拷贝对象本身还会递归拷贝对象内部所有引用类型成员即副本与原对象的引用类型成员是完全独立的新实例实现方式方式嵌套克隆在方法中对引用类型成员也调用其方法实现多层拷贝方式序列化将对象序列化为字节流再反序列化为新对象需所有成员实现接口谈一下你对的认识是一个半自动化的框架通过或注解将与对象绑定提供等标签可根据参数动态拼接解决了传统中字符串拼接的繁琐和风险如注入缓存机制一级缓存默认开启基于会话的本地缓存同一会话中多次执行相同会复用结果二级缓存可全局开启基于命名空间的缓存不同会话可共享缓存需实体类实现序列化缓存减少了数据库访问次数提升性能核心组件基于配置文件或代码配置构建是创建的工厂生命周期为应用级全局单例代表与数据库的一次会话提供增删改查的生命周期为方法级用完需关闭线程不安全接口开发者定义的接口通过或注解与语句绑定会动态生成接口的实现类避免手动编写实现存储所有配置信息数据源映射器插件等是框架的核心配置对象原理加载配置文件生成每次执行操作由完成接口通过动态代理执行执行器控制缓存与事务整体架构的功能架构大致分为三层接口层这是对开发者暴露的入口用于操作如平时使用的的等方法都是在调用该层提供的功能它还承担了事务管理和生命周期管理的重要角色数据处理层是真正干活的地方负责的构建参数映射结果集封装等核心逻辑比如会把映射文件或注解解析成内部的并通过执行具体最后由把结果集转换成对象基础支撑层负责底层资源管理包括数据库连接池事务控制插件机制日志输出等基础功能模块是运行的基础保障工作原理配置文件解析在初始化时会使用来解析配置文件其内部本质上是一个的解析器这个解析器会把配置文件读取封装成对象对象中的属性对应配置文件中的标签同时还会依照中接口的方法和的标签命名空间做绑定形成对象创建配置文件解析好后会创建一个对象并传入然后通过的方式创建并且开启事务创建的执行器将等对象全部传入获取代理对象当通过的方式去获取对象时底层其实是从的属性中的注册中心寻找到对应的代理工厂然后通过的代理生成对应的代理对象执行以查询为例代理对象执行查询时依照动态代理原理会进入到的方法进行处理本质上是拿到查询方法的名称获取对应的对象然后执行的查询的查询会先获取中的信息分页信息本次请求方法名称参数数据源等数据将这些维度生成一个缓存然后进行多级缓存处理如果缓存中没有命中则会查询数据库最后将结果返回缓存原理一级缓存基于的本地缓存其存储作用域为当或之后该中的所有缓存就将清空默认打开一级缓存二级缓存与一级缓存机制相同默认也是采用存储不同在于其存储作用域为并且可自定义存储源如默认不打开二级缓存要开启二级缓存使用二级缓存的属性类需要实现序列化接口动态的作用和原理在中动态是一项核心功能它允许根据参数的不同动态生成语句解决了传统中手动拼接时的繁琐易错如多余的注入风险等问题一动态的作用根据参数动态拼接可根据参数是否存在参数值的不同自动添加或移除片段避免手动拼接导致的语法错误如条件为空时残留或例如查询用户时若传入则按过滤传入则按过滤若都不传则查询所有简化复杂查询逻辑支持循环如条件分支如多条件判断等逻辑轻松处理批量操作如批量插入多条件组合查询等场景防止注入动态结合的参数绑定自动对参数进行转义避免手动拼接字符串带来的注入风险原理总结解析在加载文件时解析文件中的动态标签生成对应的树树每个动态标签被解析为对应的并按标签嵌套关系组成树形结构表示语句的逻辑执行时构建在执行时遍历树评估条件并生成最终的语句和的区别对比项参数位置长度限制有浏览器限制无明显限制安全性参数暴露较安全幂等性幂等非幂等浏览器缓存可缓存不可缓存常用场景查询提交表单修改数据幂等性定义同一请求多次执行结果一致要求查询新增修改删除拦截器的执行顺序执行流程之前执行可中断请求执行后渲染视图前渲染视图后执行清理资源顺序规则多个拦截器按配置顺序执行按逆序执行和拦截器和过滤器在开发中拦截器和过滤器都是用于处理请求的机制但它们的工作方式使用场景和执行时机有所不同拦截器概念拦截器是框架中的一个组件主要用于对请求进行处理通常用于在请求到达之前或返回响应之前执行一些操作它是基于的接口实现的工作时机前置拦截器在控制器方法执行前执行后置拦截器在控制器方法执行后视图渲染之前执行完成拦截器在整个请求处理完毕后执行适合用于清理资源等执行顺序拦截器按注册顺序执行前置拦截器从上到下执行后置拦截器从下到上执行完成拦截器也是从下到上执行实现方式拦截器是通过实现提供的接口来实现的或者通过继承来简化实现应用场景日志记录可以在请求进入前记录请求信息响应返回前记录响应信息权限验证拦截器常用于用户权限校验认证等操作性能监控通过前置拦截器开始计时后置拦截器记录响应时间事务管理在调用之前开始事务在完成后提交事务过滤器概念过滤器是标准中的组件定义在包中它可以对请求和响应进行预处理或后处理过滤器通常用于对请求进行统一的处理如编码转换日志记录请求参数的修改等工作时机请求到达之前过滤器在请求到达之前执行响应返回客户端之前在请求的响应被客户端接收之前过滤器可以对响应进行修改执行顺序过滤器按其在中的配置顺序执行每个过滤器都可以在链中处理请求并在处理完毕后继续传递给下一个过滤器实现方式过滤器通过实现接口来实现拦截器与过滤器的区别特性拦截器过滤器生命周期绑定到请求周期内方法绑定到请求周期内所有请求配置方式通过配置类或配置通过或配置作用范围主要作用于方法处理业务逻辑作用于所有请求通常用于请求和响应的预处理访问对象可以访问提供的等只能访问和对象请求顺序在执行前和后执行按注册顺序执行在所有之前执行按配置顺序执行执行时机仅在中起作用灵活性更强可以用于处理所有类型的请求使用场景日志记录权限校验事务管理等编码处理安全过滤日志记录等后端验证注解在后端开发中验证注解用于对请求的输入数据进行校验确保数据符合预期的格式规则等注解含义不能为空字符串非空白集合或数组非空邮箱格式正则校验数值或长度限制启用校验和用于触发验证通常用于单一对象的验证与类似但可以指定验证组适用于复杂场景常见的配置启用全局验证在项目中可以通过启用或来进行全局验证在中配置全局异常处理当验证失败时通常会抛出异常可以通过的全局异常处理机制捕获并返回错误信息如何保证消息的可靠性核心思路生产端确认机制持久化消息设置使用磁盘存储消息并通过日志文件来存储它的设计使得消息能够被长期存储并且提供了高效的读取性能提供了消息持久化选项通过将消息存储到磁盘上保证即使服务器崩溃也不丢失消息也提供了消息持久化功能支持将消息存储到数据库或文件中消费端手动防止自动丢消息自动确认消费者在接收到消息后自动向消息队列发送确认虽然方便但可能导致消息丢失尤其是在消息消费失败时手动确认消费者在成功处理完消息后通过手动发送确认信息告诉消息队列该消息已经被成功处理如果消费者未确认消息消息队列会重新投递该消息死信队列重试机制对于无法处理的消息可以将其发送到一个死信队列死信队列的作用是捕获无法成功消费的消息避免丢失并可以后续重新处理这些消息支持死信队列允许将无法消费的消息转发到其他队列进行处理可以通过分区的方式将无法处理的消息发送到不同的分区或主题中形成类似死信队列的机制幂等性保证幂等性定义幂等性保证意味着在多次执行相同操作时系统的结果是相同的即便操作被执行了多次也不会产生副作用消息消费必须具备幂等性以避免重复消费实现幂等性唯一消息标识符可以为每条消息分配一个唯一标识符如消费者在消费消息时通过检查该标识符来避免重复消费数据库去重对于需要持久化的消息可以在数据库中使用唯一索引来避免重复插入分布式锁可以通过分布式锁机制确保同一条消息只被消费一次监控与报警为了及时发现消息系统中潜在的问题应该对消息队列进行监控特别是监控以下几个方面消息积压队列中的消息积压可能意味着消费者消费能力不足消费失败监控消息消费失败的情况并进行报警重试次数如果消息重试次数过多需要进行报警或自动处理可以使用等工具进行消息队列的监控和报警模糊查询的怎么写模糊模式含义示例匹配以开头的字符串匹配以结尾的字符串匹配包含的字符串匹配中间有且两边各有一个字符的字符串若使用前缀索引失效优化使用前缀匹配或全文索引的种事务传播行为当一个事务方法被另一个事务方法调用时事务应该如何传播即是否共用当前事务是否新建事务是否挂起等在底层通过拦截事务方法在调用前后通过控制事务边界每次调用一个带事务注解的方法时会检查当前线程是否已存在事务根据传播行为判断是加入当前事务还是新建一个事务还是挂起当前事务还是抛异常终止编号传播行为含义是否复用当前事务是否创建新事务当前无事务是否创建常见场景默认有事务就加入没有就新建无事务时常用默认行为每次都新建事务挂起外部事务独立事务如日志记录有事务就加入没有就非事务执行可选事务逻辑如果有事务则挂起当前事务执行非事务逻辑如大批量查询必须存在事务否则抛异常抛异常子方法强依赖上层事务不允许存在事务否则抛异常严格非事务环境嵌套事务外层回滚时一起回滚内层可独立回滚外层事务中保存点复杂业务场景分段回滚事务失效事务方法不是非如不会被代理拦截同类方法内部调用导致事务失效事务是通过代理实现的自调用不会触发代理逻辑异常被捕获导致事务不回滚默认只在或时回滚如果抛出的是受检异常默认不会回滚数据源未被管理事务管理器必须基于同一个容器内的数据源否则事务不会生效多线程环境中事务失效事务是基于绑定的多个线程不共享事务上下文事务传播属性设置不合适比如外层没有事务而内层方法设置了或会导致预期外的事务行为个属性属性说明事务传播行为隔离级别超时时间事务执行的最长时间秒超时后会强制回滚是否只读优化数据库访问性能声明该事务不涉及写操作指定回滚异常类型为什么需要预编译在执行前先由数据库服务器对模板进行编译与优化之后只需绑定参数即可重复执行而无需重新编译防止注入攻击安全性非预编译方式用户输入最终使用预编译提高性能与安全性优点减少解析开销防止注入批量执行优化内部就是通过实现预编译有哪些使用场景掌握消息队列是一种异步通信中间件用于在系统之间解耦削峰异步处理保证可靠传输生产者把消息发送到队列中消费者异步地从队列中获取消息执行操作常见的产品包括基于协议可靠性强高吞吐适合日志和大数据阿里开源支持事务消息老牌消息中间件为什么需要解决什么问题主要解决三类问题解耦场景订单系统库存系统积分系统通知系统如果强耦合当积分或通知模块挂掉整个链路都出问题解决订单模块只需发消息到后续系统异步消费不必强依赖好处低耦合可扩展只需增加消费者异步场景用户下单发短信发邮件记录日志推送积分问题这些操作不影响主流程但耗时长解决把这些操作通过异步处理主线程立刻响应提高响应速度削峰场景秒杀大促抢红包场景下流量瞬间暴增问题如果请求直打数据库可能导致崩溃解决作为缓冲层生产者写入消息消费者按能力消费系统更稳场景说明异步解耦下单后异步发短信邮件流量削峰秒杀抢购场景日志收集埋点上报分布式事务通过最终一致性延迟任务订单超时取消项目实践结合经验比如在我的商城项目中用户下单后我们使用实现了异步解耦订单服务只负责生成订单然后发送订单创建成功消息库存服务积分服务消息通知服务分别订阅该进行处理避免了服务间强依赖降低了数据库压力提高了下单接口的响应速度面试官追问回答要点消息重复消费怎么办设计幂等性如唯一消息或状态表消息丢失怎么办开启持久化确认机制重试机制消息顺序怎么保证按业务分区单线程消费如何处理消费失败重试机制死信队列事务消息原理本地事务消息半提交回查机制',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-10-23 10:19:32',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://s2.loli.net/2022/11/07/QVWvrnAsuGxelbS.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">北川的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/./img/wechat.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="/./img/wechat.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/./img/alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/./img/alipay.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java%E6%95%99%E7%A8%8B/" style="font-size: 1.05rem;">java教程<sup>1</sup></a><a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 1.05rem;">函数<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 1.05rem;">反射<sup>1</sup></a><a href="/tags/%E5%A4%8D%E4%B9%A0/" style="font-size: 1.05rem;">复习<sup>1</sup></a><a href="/tags/%E5%A4%8D%E4%B9%A0-%E5%8F%98%E9%87%8F/" style="font-size: 1.05rem;">复习 变量<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">工具<sup>1</sup></a><a href="/tags/%E6%83%85%E6%84%9F/" style="font-size: 1.05rem;">情感<sup>1</sup></a><a href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E6%8E%A5%E5%8F%A3/" style="font-size: 1.05rem;">抽象类 接口<sup>1</sup></a><a href="/tags/%E6%AF%8F%E6%97%A5%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">每日面试<sup>2</sup></a><a href="/tags/%E7%94%B5%E5%95%86-%E8%AE%A2%E5%8D%95/" style="font-size: 1.05rem;">电商,订单<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%B6%85%E5%8D%96-%E5%BA%93%E5%AD%98/" style="font-size: 1.05rem;">超卖 , 库存<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url">面试题</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%AF%8F%E6%97%A5%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>每日面试</span></a></span></div></div><h1 class="post-title" itemprop="name headline">1022面试题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-10-21T17:23:36.000Z" title="发表于 2025-10-22 01:23:36">2025-10-22</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-10-23T02:19:32.250Z" title="更新于 2025-10-23 10:19:32">2025-10-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="1022面试题"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新乡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新乡</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/69be1e2f.html#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/posts/69be1e2f.html" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://s2.loli.net/2025/10/23/pH7DOX5rqdLCk4b.jpg?_r_=a6fd3437-28f4-cb41-7271-bc60ac64be0a"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://gukeyang.github.io/posts/69be1e2f.html"><header><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url">面试题</a><a href="/tags/%E6%AF%8F%E6%97%A5%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url">每日面试</a><h1 id="CrawlerTitle" itemprop="name headline">1022面试题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">北川</span><time itemprop="dateCreated datePublished" datetime="2025-10-21T17:23:36.000Z" title="发表于 2025-10-22 01:23:36">2025-10-22</time><time itemprop="dateCreated datePublished" datetime="2025-10-23T02:19:32.250Z" title="更新于 2025-10-23 10:19:32">2025-10-23</time></header><h1 id="每日面试题"><a href="#每日面试题" class="headerlink" title="每日面试题"></a>每日面试题</h1><h2 id="1-索引哪些情况会失效"><a href="#1-索引哪些情况会失效" class="headerlink" title="1.索引哪些情况会失效?"></a>1.索引哪些情况会失效?</h2><p>常见的失效场景：</p>
<table>
<thead>
<tr>
<th>情况</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1. 使用 <code>or</code> 连接不同字段</td>
<td>如果 <code>or</code> 两边有一个字段无索引，会导致全表扫描。</td>
</tr>
<tr>
<td>2. 对索引列使用函数或计算</td>
<td>如 <code>where length(name)=3</code>、<code>where age+1=10</code>。</td>
</tr>
<tr>
<td>3. 使用 <code>%</code> 开头的模糊匹配</td>
<td><code>like &#39;%abc&#39;</code> 不能走索引，而 <code>like &#39;abc%&#39;</code> 可以。</td>
</tr>
<tr>
<td>4. 字符串类型未加引号</td>
<td><code>where name=123</code> 导致隐式类型转换。</td>
</tr>
<tr>
<td>5. 不符合最左前缀原则</td>
<td>复合索引 <code>(a,b,c)</code>，只查询 <code>b,c</code> 不会用上。</td>
</tr>
<tr>
<td>6. 使用 <code>!=</code>、<code>&lt;&gt;</code>、<code>is null</code>、<code>is not null</code></td>
<td>通常会导致放弃索引。</td>
</tr>
<tr>
<td>7. 索引字段参与比较但列类型不匹配</td>
<td>比如 int 和 varchar 比较。</td>
</tr>
<tr>
<td>8.数据分布不均匀</td>
<td>当索引列的数据分布极度不均匀时，索引的效果会大打折扣</td>
</tr>
<tr>
<td>9.索引字段为 <code>NULL</code> 值</td>
<td>当查询条件涉及索引列的 <code>NULL</code> 值时，无法使用索引来定位 <code>NULL</code> 值，进行全表扫描</td>
</tr>
</tbody></table>
<h3 id="通过-EXPLAIN-判断索引是否有效：关注-type-字段"><a href="#通过-EXPLAIN-判断索引是否有效：关注-type-字段" class="headerlink" title="通过 EXPLAIN 判断索引是否有效：关注 type 字段"></a>通过 <code>EXPLAIN</code> 判断索引是否有效：关注 <code>type</code> 字段</h3><p><code>EXPLAIN</code> 结果中的 <code>type</code> 字段表示表的连接类型，直接反映了索引的使用效率，从优到劣的常见类型如下：</p>
<ul>
<li>**<code>system</code>**：表中只有一行数据（如系统表），是 <code>const</code> 的特例，效率最高。</li>
<li>**<code>const</code>**：通过主键或唯一索引查询，最多返回一行数据（如 <code>where id = 1</code>），效率极高。</li>
<li>**<code>eq_ref</code>**：多表连接时，被连接表通过主键或唯一索引匹配，每行只匹配一次（如 <code>join on 主键</code>）。</li>
<li>**<code>ref</code>**：非唯一索引匹配，可能返回多行（如 <code>where name = &#39;xxx&#39;</code>，<code>name</code> 是普通索引），效率较高。</li>
<li>**<code>range</code>**：索引范围扫描（如 <code>where id between 1 and 10</code> 或 <code>like &#39;xxx%&#39;</code>），只扫描索引的某一段，效率优于全表扫描。</li>
<li>**<code>index</code>**：扫描整个索引树（如 <code>select count(*) from table</code> 且有索引），虽扫描全部索引，但索引通常比数据小，效率优于全表扫描。</li>
<li>**<code>ALL</code>**：全表扫描（未使用索引），效率最低，需优先优化。</li>
</ul>
<p><strong>结论</strong>：<code>type</code> 为 <code>ref</code>、<code>range</code>、<code>index</code> 时，说明索引被有效使用（效率依次降低）；若为 <code>ALL</code>，则表示未使用索引，需检查索引设计或 SQL 语句。</p>
<h3 id="覆盖索引：避免回表，优化查询效率"><a href="#覆盖索引：避免回表，优化查询效率" class="headerlink" title="覆盖索引：避免回表，优化查询效率"></a>覆盖索引：避免回表，优化查询效率</h3><p>覆盖索引是指查询所需的字段（<code>select</code> 后的列）全部包含在某一索引中，此时 MySQL 无需访问表数据，仅通过索引即可返回结果，避免了 “回表”（从索引树找到主键后再去聚簇索引查完整数据），显著提升效率。</p>
<p><strong><code>EXPLAIN</code> 识别</strong>：覆盖索引时，<code>Extra</code> 字段会显示 <code>Using index</code>。</p>
<h3 id="索引下推（ICP，Index-Condition-Pushdown）：减少回表次数"><a href="#索引下推（ICP，Index-Condition-Pushdown）：减少回表次数" class="headerlink" title="索引下推（ICP，Index Condition Pushdown）：减少回表次数"></a>索引下推（ICP，Index Condition Pushdown）：减少回表次数</h3><p>MySQL 5.6 引入的索引下推优化，用于在索引扫描过程中提前过滤不符合条件的记录，减少回表次数。</p>
<p><strong>原理</strong>：在没有 ICP 时，存储引擎通过索引找到符合 <code>range</code> 或 <code>ref</code> 条件的主键后，会先回表获取完整数据，再由服务器层过滤其他 <code>where</code> 条件；有 ICP 时，存储引擎在索引扫描阶段，会同时判断索引中包含的其他条件（如联合索引中的非前缀列），直接过滤掉不符合条件的记录，仅对剩余记录回表，减少回表次数。</p>
<p><strong><code>EXPLAIN</code> 识别</strong>：触发 ICP 时，<code>Extra</code> 字段会显示 <code>Using index condition</code></p>
<h2 id="2-final、finalize、finally三者的不同"><a href="#2-final、finalize、finally三者的不同" class="headerlink" title="2.final、finalize、finally三者的不同?"></a>2.final、finalize、finally三者的不同?</h2><table>
<thead>
<tr>
<th>关键字</th>
<th>用途</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td><code>final</code></td>
<td>修饰类、方法、变量</td>
<td>类不可继承、方法不可重写、变量不可修改</td>
</tr>
<tr>
<td><code>finalize()</code></td>
<td>Object类方法</td>
<td>GC前回调一次，已过时，JDK9后废弃</td>
</tr>
<tr>
<td><code>finally</code></td>
<td>异常处理结构</td>
<td>保证一定执行（除非 System.exit）</td>
</tr>
</tbody></table>
<p><strong>final 对象引用不可变，但内部属性可变：</strong></p>
<p>当用 <code>final</code> 修饰一个对象变量时，这个变量（引用）一旦指向某个对象，就<strong>不能再指向其他对象</strong>（即引用的内存地址不可变）。但对象本身在内存中的数据（属性）是可以被修改的。</p>
<h2 id="3-java中深拷贝和浅拷贝"><a href="#3-java中深拷贝和浅拷贝" class="headerlink" title="3.java中深拷贝和浅拷贝?"></a>3.java中深拷贝和浅拷贝?</h2><p>在 Java 中，<strong>拷贝（Copy）</strong> 指创建一个对象的副本。根据副本对象与原对象的依赖关系，分为<strong>浅拷贝（Shallow Copy）</strong> 和<strong>深拷贝（Deep Copy）</strong>，核心区别在于是否拷贝对象内部的引用类型成员。</p>
<h3 id="1-浅拷贝（Shallow-Copy）"><a href="#1-浅拷贝（Shallow-Copy）" class="headerlink" title="1. 浅拷贝（Shallow Copy）"></a>1. 浅拷贝（Shallow Copy）</h3><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><p>只拷贝对象本身（基本类型成员直接复制值），但对于对象内部的<strong>引用类型成员</strong>，仅拷贝其引用地址（即副本与原对象共享同一个引用类型成员的实例）。</p>
<h4 id="实现方式："><a href="#实现方式：" class="headerlink" title="实现方式："></a>实现方式：</h4><ul>
<li>让类实现 <code>Cloneable</code> 接口（标记接口，无实际方法）。</li>
<li>重写 <code>Object</code> 类的 <code>clone()</code> 方法，默认返回浅拷贝对象。</li>
</ul>
<h3 id="2-深拷贝（Deep-Copy）"><a href="#2-深拷贝（Deep-Copy）" class="headerlink" title="2. 深拷贝（Deep Copy）"></a>2. 深拷贝（Deep Copy）</h3><h4 id="定义：-1"><a href="#定义：-1" class="headerlink" title="定义："></a>定义：</h4><p>不仅拷贝对象本身，还会递归拷贝对象内部所有<strong>引用类型成员</strong>（即副本与原对象的引用类型成员是完全独立的新实例）。</p>
<h4 id="实现方式：-1"><a href="#实现方式：-1" class="headerlink" title="实现方式："></a>实现方式：</h4><ul>
<li><strong>方式 1（嵌套克隆）</strong>：在 <code>clone()</code> 方法中，对引用类型成员也调用其 <code>clone()</code> 方法，实现多层拷贝。</li>
<li><strong>方式 2（序列化）</strong>：将对象序列化为字节流，再反序列化为新对象（需所有成员实现 <code>Serializable</code> 接口）。</li>
</ul>
<h2 id="4-谈一下你对MyBatis的认识"><a href="#4-谈一下你对MyBatis的认识" class="headerlink" title="4.谈一下你对MyBatis的认识?"></a>4.谈一下你对MyBatis的认识?</h2><p>MyBatis 是一个 <strong>半自动化的 ORM 框架</strong>，通过 XML 或注解将 SQL 与 Java 对象绑定。提供 <code>&lt;if&gt;</code>、<code>&lt;where&gt;</code>、<code>&lt;foreach&gt;</code> 等标签，可根据参数动态拼接 SQL，解决了传统 JDBC 中字符串拼接 SQL 的繁琐和风险（如 SQL 注入）。</p>
<h3 id="缓存机制"><a href="#缓存机制" class="headerlink" title="缓存机制"></a><strong>缓存机制</strong></h3><ul>
<li><strong>一级缓存</strong>：默认开启，基于 SqlSession（会话）的本地缓存，同一会话中多次执行相同 SQL 会复用结果。</li>
<li>二级缓存：可全局开启，基于 Mapper 命名空间的缓存，不同会话可共享缓存（需实体类实现序列化）。缓存减少了数据库访问次数，提升性能。</li>
</ul>
<h3 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h3><ol>
<li><strong>SqlSessionFactory</strong>基于配置文件（mybatis-config.xml）或代码配置构建，是创建 SqlSession 的工厂，生命周期为应用级（全局单例）。</li>
<li><strong>SqlSession</strong>代表与数据库的一次会话，提供增删改查的 API，生命周期为方法级（用完需关闭），线程不安全。</li>
<li><strong>Mapper 接口</strong>开发者定义的接口，通过 XML 或注解与 SQL 语句绑定，MyBatis 会动态生成接口的实现类，避免手动编写 DAO 实现。</li>
<li><strong>Configuration</strong>存储 MyBatis 所有配置信息（数据源、映射器、插件等），是框架的核心配置对象。</li>
</ol>
<h3 id="⚙️-原理："><a href="#⚙️-原理：" class="headerlink" title="⚙️ 原理："></a>⚙️ 原理：</h3><ol>
<li>加载配置文件生成 <code>SqlSessionFactory</code></li>
<li>每次执行操作由 <code>SqlSession</code> 完成</li>
<li>Mapper 接口通过动态代理执行 SQL</li>
<li>执行器（Executor）控制缓存与事务</li>
</ol>
<h3 id="MyBatis-整体架构"><a href="#MyBatis-整体架构" class="headerlink" title="MyBatis 整体架构"></a>MyBatis 整体架构</h3><p>MyBatis 的功能架构大致分为三层：</p>
<ul>
<li><strong>API 接口层</strong>：这是对开发者暴露的入口，用于操作 MyBatis，如平时使用的<code>SqlSession</code>的<code>selectOne</code>、<code>insert</code>等方法都是在调用该层提供的功能。它还承担了 “事务管理” 和 “生命周期管理” 的重要角色。</li>
<li><strong>数据处理层</strong>：是 MyBatis 真正 “干活” 的地方，负责 SQL 的构建、参数映射、结果集封装等核心逻辑。比如会把 XML 映射文件或注解 SQL 解析成内部的<code>MappedStatement</code>，并通过<code>Executor</code>执行具体 SQL，最后由<code>ResultSetHandler</code>把结果集转换成 Java 对象。</li>
<li><strong>基础支撑层</strong>：负责底层资源管理，包括数据库连接池、事务控制、插件机制、日志输出等基础功能模块，是 MyBatis 运行的基础保障。</li>
</ul>
<h3 id="MyBatis-工作原理"><a href="#MyBatis-工作原理" class="headerlink" title="MyBatis 工作原理"></a>MyBatis 工作原理</h3><ul>
<li><strong>配置文件解析</strong>：MyBatis 在初始化时，会使用<code>SqlSessionFactoryBuilder</code>来解析配置文件，其内部本质上是一个<code>XMLConfigBuilder</code>的 XML 解析器。这个解析器会把配置文件读取，封装成<code>Configuration</code>对象，<code>Configuration</code>对象中的属性对应配置文件中的标签。同时，MyBatis 还会依照 Mapper.java 中接口的方法和 Mapper.xml 的 sql 标签命名空间做绑定，形成<code>MappedStatement</code>对象。</li>
<li><strong>创建 SqlSession</strong>：配置文件解析好后，会创建一个<code>DefaultSqlSessionFactory</code>对象，并传入<code>Configuration</code>。然后<code>DefaultSqlSessionFactory</code>通过<code>openSession</code>的方式创建<code>DefaultSqlSession</code>，并且开启事务，创建 SQL 的执行器，将<code>Configuration</code>等对象全部传入<code>DefaultSqlSession</code>。</li>
<li><strong>获取 Mapper 代理对象</strong>：当通过<code>sqlSession.getMapper(Mapper.class)</code>的方式去获取 mapper 对象时，底层其实是从<code>sqlSession</code>的属性<code>Configuration</code>中的 mapper 注册中心寻找到对应的代理工厂，然后通过<code>MapperProxy</code>的代理生成对应的代理对象。</li>
<li><strong>执行 SQL</strong>：以查询为例，mapper 代理对象执行查询时，依照 JDK 动态代理原理，会进入到<code>MapperProxy</code>的<code>invoke</code>方法进行处理，本质上是拿到查询方法的名称，获取对应的<code>MappedStatement</code>对象，然后执行<code>SqlSession</code>的查询。<code>SqlSession</code>的查询会先获取<code>MappedStatement</code>中 SQL 的信息、分页信息、本次请求方法名称、参数、数据源等数据，将这些维度生成一个缓存 key，然后进行多级缓存处理。如果缓存中没有命中，则会查询数据库，最后将结果返回。</li>
</ul>
<h3 id="MyBatis-缓存原理"><a href="#MyBatis-缓存原理" class="headerlink" title="MyBatis 缓存原理"></a>MyBatis 缓存原理</h3><ul>
<li><strong>一级缓存</strong>：基于<code>PerpetualCache</code>的<code>HashMap</code>本地缓存，其存储作用域为<code>Session</code>。当<code>Session flush</code>或<code>close</code>之后，该<code>Session</code>中的所有缓存就将清空，默认打开一级缓存。</li>
<li><strong>二级缓存</strong>：与一级缓存机制相同，默认也是采用<code>PerpetualCache</code>，<code>HashMap</code>存储，不同在于其存储作用域为<code>Mapper(Namespace)</code>，并且可自定义存储源，如<code>Ehcache</code>。默认不打开二级缓存，要开启二级缓存，使用二级缓存的属性类需要实现<code>Serializable</code>序列化接口。</li>
</ul>
<h2 id="5-动态SQL的作用和原理"><a href="#5-动态SQL的作用和原理" class="headerlink" title="5.动态SQL的作用和原理"></a>5.动态SQL的作用和原理</h2><p>在 MyBatis 中，<strong>动态 SQL</strong> 是一项核心功能，它允许根据参数的不同动态生成 SQL 语句，解决了传统 JDBC 中手动拼接 SQL 时的繁琐、易错（如多余的 <code>AND/OR</code>、SQL 注入风险）等问题。</p>
<h3 id="一、动态-SQL-的作用"><a href="#一、动态-SQL-的作用" class="headerlink" title="一、动态 SQL 的作用"></a><strong>一、动态 SQL 的作用</strong></h3><ol>
<li><strong>根据参数动态拼接 SQL</strong>可根据参数是否存在、参数值的不同，自动添加或移除 SQL 片段，避免手动拼接导致的语法错误（如条件为空时残留 <code>WHERE</code> 或 <code>AND</code>）。例如：查询用户时，若传入 <code>name</code> 则按 <code>name</code> 过滤，传入 <code>age</code> 则按 <code>age</code> 过滤，若都不传则查询所有。</li>
<li><strong>简化复杂查询逻辑</strong>支持循环（如 <code>IN</code> 条件）、分支（如多条件判断）等逻辑，轻松处理批量操作（如批量插入）、多条件组合查询等场景。</li>
<li><strong>防止 SQL 注入</strong>动态 SQL 结合 MyBatis 的参数绑定（<code>#&#123;&#125;</code>），自动对参数进行转义，避免手动拼接字符串（<code>$&#123;&#125;</code>）带来的 SQL 注入风险。</li>
</ol>
<h3 id="原理总结"><a href="#原理总结" class="headerlink" title="原理总结"></a><strong>原理总结</strong></h3><ul>
<li><strong>XML 解析</strong>：MyBatis 在加载 Mapper 文件时，解析 XML 文件中的动态标签，生成对应的 <code>SqlNode</code> 树。</li>
<li><strong>SqlNode 树</strong>：每个动态标签被解析为对应的 <code>SqlNode</code>，并按标签嵌套关系组成树形结构，表示 SQL 语句的逻辑。</li>
<li><strong>执行时构建 SQL</strong>：在 SQL 执行时，MyBatis 遍历 <code>SqlNode</code> 树，评估条件并生成最终的 SQL 语句。</li>
</ul>
<h2 id="6-get和post的区别"><a href="#6-get和post的区别" class="headerlink" title="6.get和post的区别?"></a>6.get和post的区别?</h2><table>
<thead>
<tr>
<th>对比项</th>
<th>GET</th>
<th>POST</th>
</tr>
</thead>
<tbody><tr>
<td>参数位置</td>
<td>URL</td>
<td>Body</td>
</tr>
<tr>
<td>长度限制</td>
<td>有（浏览器限制）</td>
<td>无明显限制</td>
</tr>
<tr>
<td>安全性</td>
<td>参数暴露</td>
<td>较安全</td>
</tr>
<tr>
<td>幂等性</td>
<td>幂等</td>
<td>非幂等</td>
</tr>
<tr>
<td>浏览器缓存</td>
<td>可缓存</td>
<td>不可缓存</td>
</tr>
<tr>
<td>常用场景</td>
<td>查询</td>
<td>提交表单、修改数据</td>
</tr>
</tbody></table>
<p>幂等性定义：同一请求多次执行结果一致。</p>
<p>RESTful 要求：GET 查询、POST 新增、PUT 修改、DELETE 删除。</p>
<h2 id="7-spring拦截器的执行顺序"><a href="#7-spring拦截器的执行顺序" class="headerlink" title="7.spring拦截器的执行顺序?"></a>7.spring拦截器的执行顺序?</h2><h3 id="✅-执行流程："><a href="#✅-执行流程：" class="headerlink" title="✅ 执行流程："></a>✅ 执行流程：</h3><ol>
<li><code>preHandle()</code> → Controller 之前执行，可中断请求。</li>
<li><code>postHandle()</code> → Controller 执行后，渲染视图前。</li>
<li><code>afterCompletion()</code> → 渲染视图后执行（清理资源）。</li>
</ol>
<h3 id="✅-顺序规则："><a href="#✅-顺序规则：" class="headerlink" title="✅ 顺序规则："></a>✅ 顺序规则：</h3><ul>
<li>多个拦截器按 <strong>配置顺序执行 preHandle</strong></li>
<li>按 <strong>逆序执行 postHandle 和 afterCompletion</strong></li>
</ul>
<p><strong>拦截器和过滤器</strong></p>
<p>在 Web 开发中，<strong>拦截器</strong>（Interceptor）和<strong>过滤器</strong>（Filter）都是用于处理 HTTP 请求的机制，但它们的工作方式、使用场景和执行时机有所不同。</p>
<h3 id="1-拦截器（Interceptor）"><a href="#1-拦截器（Interceptor）" class="headerlink" title="1. 拦截器（Interceptor）"></a>1. <strong>拦截器（Interceptor）</strong></h3><h4 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1. 概念"></a>1.1. <strong>概念</strong></h4><p>拦截器是 Spring 框架中的一个组件，主要用于对 HTTP 请求进行处理，通常用于在请求到达 Controller 之前或返回响应之前执行一些操作。它是基于 Spring MVC 的 HandlerInterceptor 接口实现的。</p>
<h4 id="1-2-工作时机"><a href="#1-2-工作时机" class="headerlink" title="1.2. 工作时机"></a>1.2. <strong>工作时机</strong></h4><ul>
<li><strong>前置拦截器（preHandle）</strong>：在控制器方法执行前执行。</li>
<li><strong>后置拦截器（postHandle）</strong>：在控制器方法执行后，视图渲染之前执行。</li>
<li><strong>完成拦截器（afterCompletion）</strong>：在整个请求处理完毕后执行，适合用于清理资源等。</li>
</ul>
<h4 id="1-3-执行顺序"><a href="#1-3-执行顺序" class="headerlink" title="1.3. 执行顺序"></a>1.3. <strong>执行顺序</strong></h4><ul>
<li>拦截器按注册顺序执行：前置拦截器从上到下执行，后置拦截器从下到上执行，完成拦截器也是从下到上执行。</li>
</ul>
<h4 id="1-4-实现方式"><a href="#1-4-实现方式" class="headerlink" title="1.4. 实现方式"></a>1.4. <strong>实现方式</strong></h4><p>拦截器是通过实现 Spring MVC 提供的 <code>HandlerInterceptor</code> 接口来实现的，或者通过继承 <code>HandlerInterceptorAdapter</code> 来简化实现。</p>
<h4 id="1-5-应用场景"><a href="#1-5-应用场景" class="headerlink" title="1.5. 应用场景"></a>1.5. <strong>应用场景</strong></h4><ul>
<li><strong>日志记录</strong>：可以在请求进入前记录请求信息，响应返回前记录响应信息。</li>
<li><strong>权限验证</strong>：拦截器常用于用户权限校验、认证等操作。</li>
<li><strong>性能监控</strong>：通过前置拦截器开始计时，后置拦截器记录响应时间。</li>
<li><strong>事务管理</strong>：在 Controller 调用之前开始事务，在 Controller 完成后提交事务。</li>
</ul>
<h3 id="2-过滤器（Filter）"><a href="#2-过滤器（Filter）" class="headerlink" title="2. 过滤器（Filter）"></a>2. <strong>过滤器（Filter）</strong></h3><h4 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2.1. 概念"></a>2.1. <strong>概念</strong></h4><p>过滤器是 Java EE 标准中的组件，定义在 <code>javax.servlet</code> 包中，它可以对 HTTP 请求和响应进行预处理或后处理。过滤器通常用于对请求进行统一的处理，如编码转换、日志记录、请求参数的修改等。</p>
<h4 id="2-2-工作时机"><a href="#2-2-工作时机" class="headerlink" title="2.2. 工作时机"></a>2.2. <strong>工作时机</strong></h4><ul>
<li><strong>请求到达 Servlet 之前</strong>：过滤器在请求到达 Servlet 之前执行。</li>
<li><strong>响应返回客户端之前</strong>：在请求的响应被客户端接收之前，过滤器可以对响应进行修改。</li>
</ul>
<h4 id="2-3-执行顺序"><a href="#2-3-执行顺序" class="headerlink" title="2.3. 执行顺序"></a>2.3. <strong>执行顺序</strong></h4><ul>
<li>过滤器按其在 <code>web.xml</code> 中的配置顺序执行。</li>
<li>每个过滤器都可以在链中处理请求，并在处理完毕后继续传递给下一个过滤器。</li>
</ul>
<h4 id="2-4-实现方式"><a href="#2-4-实现方式" class="headerlink" title="2.4. 实现方式"></a>2.4. <strong>实现方式</strong></h4><p>过滤器通过实现 <code>javax.servlet.Filter</code> 接口来实现。</p>
<h3 id="拦截器与过滤器的区别"><a href="#拦截器与过滤器的区别" class="headerlink" title="拦截器与过滤器的区别"></a><strong>拦截器与过滤器的区别</strong></h3><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>拦截器</strong></th>
<th><strong>过滤器</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>生命周期</strong></td>
<td>绑定到 Spring MVC 请求周期内（Controller 方法）</td>
<td>绑定到 Servlet 请求周期内（所有请求）</td>
</tr>
<tr>
<td><strong>配置方式</strong></td>
<td>通过 Spring 配置类或 <code>xml</code> 配置（<code>WebMvcConfigurer</code>）</td>
<td>通过 <code>web.xml</code> 或 <code>FilterRegistrationBean</code> 配置</td>
</tr>
<tr>
<td><strong>作用范围</strong></td>
<td>主要作用于 Controller 方法，处理业务逻辑</td>
<td>作用于所有请求，通常用于请求和响应的预处理</td>
</tr>
<tr>
<td><strong>访问对象</strong></td>
<td>可以访问 Spring MVC 提供的 <code>ModelAndView</code>、<code>Handler</code> 等</td>
<td>只能访问 <code>ServletRequest</code> 和 <code>ServletResponse</code> 对象</td>
</tr>
<tr>
<td><strong>请求顺序</strong></td>
<td>在 Controller 执行前和后执行，按注册顺序执行</td>
<td>在所有 Servlet 之前执行，按配置顺序执行</td>
</tr>
<tr>
<td><strong>执行时机</strong></td>
<td>仅在 Spring MVC 中起作用，灵活性更强</td>
<td>可以用于处理所有类型的 HTTP 请求</td>
</tr>
<tr>
<td><strong>使用场景</strong></td>
<td>日志记录、权限校验、事务管理等</td>
<td>编码处理、安全过滤、日志记录等</td>
</tr>
</tbody></table>
<h2 id="8-后端验证注解"><a href="#8-后端验证注解" class="headerlink" title="8.后端验证注解?"></a>8.后端验证注解?</h2><p>在后端开发中，<strong>验证注解</strong>（Validation Annotations）用于对请求的输入数据进行校验，确保数据符合预期的格式、规则等。</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>@NotNull</code></td>
<td>不能为空</td>
</tr>
<tr>
<td><code>@NotBlank</code></td>
<td>字符串非空白</td>
</tr>
<tr>
<td><code>@NotEmpty</code></td>
<td>集合或数组非空</td>
</tr>
<tr>
<td><code>@Email</code></td>
<td>邮箱格式</td>
</tr>
<tr>
<td><code>@Pattern</code></td>
<td>正则校验</td>
</tr>
<tr>
<td><code>@Min/@Max/@Size</code></td>
<td>数值或长度限制</td>
</tr>
<tr>
<td><code>@Valid</code> &#x2F; <code>@Validated</code></td>
<td>启用校验</td>
</tr>
</tbody></table>
<h4 id="Valid-和-Validated"><a href="#Valid-和-Validated" class="headerlink" title="@Valid 和 @Validated"></a><strong>@Valid 和 @Validated</strong></h4><ul>
<li>**<code>@Valid</code>**：用于触发 Java Bean 验证，通常用于单一对象的验证。</li>
<li>**<code>@Validated</code>**：与 <code>@Valid</code> 类似，但可以指定验证组，适用于复杂场景。</li>
</ul>
<h3 id="常见的-Spring-配置"><a href="#常见的-Spring-配置" class="headerlink" title="常见的 Spring 配置"></a><strong>常见的 Spring 配置</strong></h3><h4 id="启用全局验证"><a href="#启用全局验证" class="headerlink" title="启用全局验证"></a><strong>启用全局验证</strong></h4><p>在 Spring Boot 项目中，可以通过启用 <code>@Valid</code> 或 <code>@Validated</code> 来进行全局验证。</p>
<p>在 <code>application.properties</code> 中配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring.mvc.throwExceptionIfNoHandlerFound=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a><strong>全局异常处理</strong></h4><p>当验证失败时，通常会抛出 <code>MethodArgumentNotValidException</code> 异常。可以通过 Spring 的全局异常处理机制捕获并返回错误信息。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">handleValidationExceptions</span><span class="params">(MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">error</span> <span class="operator">=</span> ex.getBindingResult()</span><br><span class="line">                          .getFieldError()</span><br><span class="line">                          .getDefaultMessage();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-如何保证消息的可靠性"><a href="#9-如何保证消息的可靠性" class="headerlink" title="9.如何保证消息的可靠性"></a>9.如何保证消息的可靠性</h2><h3 id="✅-核心思路："><a href="#✅-核心思路：" class="headerlink" title="✅ 核心思路："></a>✅ 核心思路：</h3><ol>
<li><p><strong>生产端确认机制</strong></p>
<ul>
<li>Confirm Callback + Return Callback（RabbitMQ）</li>
</ul>
</li>
<li><p><strong>持久化消息</strong></p>
<ul>
<li><p>设置 <code>deliveryMode=2</code></p>
</li>
<li><p><strong>Kafka</strong>：Kafka 使用磁盘存储消息并通过日志文件来存储。它的设计使得消息能够被长期存储，并且提供了高效的读取性能。</p>
<p><strong>RabbitMQ</strong>：RabbitMQ 提供了消息持久化选项，通过将消息存储到磁盘上，保证即使服务器崩溃也不丢失消息。</p>
<p><strong>ActiveMQ</strong>：ActiveMQ 也提供了消息持久化功能，支持将消息存储到数据库或文件中</p>
</li>
</ul>
</li>
<li><p><strong>消费端手动 ACK</strong></p>
<ul>
<li><p>防止自动 ACK 丢消息</p>
</li>
<li><p><strong>自动确认</strong>：消费者在接收到消息后，自动向消息队列发送确认。虽然方便，但可能导致消息丢失，尤其是在消息消费失败时。</p>
<p><strong>手动确认</strong>：消费者在成功处理完消息后，通过手动发送确认信息告诉消息队列该消息已经被成功处理。如果消费者未确认消息，消息队列会重新投递该消息。</p>
</li>
</ul>
</li>
<li><p><strong>死信队列 + 重试机制</strong></p>
<ul>
<li>对于无法处理的消息，可以将其发送到一个死信队列（DLQ）。死信队列的作用是捕获无法成功消费的消息，避免丢失，并可以后续重新处理这些消息。<ul>
<li><strong>RabbitMQ</strong>：支持死信队列，允许将无法消费的消息转发到其他队列进行处理。</li>
<li><strong>Kafka</strong>：可以通过分区的方式，将无法处理的消息发送到不同的分区或主题中，形成类似死信队列的机制。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="幂等性保证"><a href="#幂等性保证" class="headerlink" title="幂等性保证"></a><strong>幂等性保证</strong></h3><h4 id="幂等性定义"><a href="#幂等性定义" class="headerlink" title="幂等性定义"></a><strong>幂等性定义</strong></h4><p>幂等性保证意味着在多次执行相同操作时，系统的结果是相同的，即便操作被执行了多次，也不会产生副作用。消息消费必须具备幂等性，以避免重复消费。</p>
<h4 id="实现幂等性"><a href="#实现幂等性" class="headerlink" title="实现幂等性"></a><strong>实现幂等性</strong></h4><ul>
<li><strong>唯一消息标识符</strong>：可以为每条消息分配一个唯一标识符（如 UUID），消费者在消费消息时，通过检查该标识符来避免重复消费。</li>
<li><strong>数据库去重</strong>：对于需要持久化的消息，可以在数据库中使用唯一索引来避免重复插入。</li>
<li><strong>分布式锁</strong>：可以通过分布式锁机制，确保同一条消息只被消费一次。</li>
</ul>
<h3 id="监控与报警"><a href="#监控与报警" class="headerlink" title="监控与报警"></a>监控与报警</h3><p>为了及时发现消息系统中潜在的问题，应该对消息队列进行监控，特别是监控以下几个方面：</p>
<ul>
<li><strong>消息积压</strong>：队列中的消息积压可能意味着消费者消费能力不足。</li>
<li><strong>消费失败</strong>：监控消息消费失败的情况，并进行报警。</li>
<li><strong>重试次数</strong>：如果消息重试次数过多，需要进行报警或自动处理。</li>
</ul>
<p>可以使用 Prometheus + Grafana 等工具进行消息队列的监控和报警。</p>
<h2 id="10-模糊查询的like怎么写"><a href="#10-模糊查询的like怎么写" class="headerlink" title="10.模糊查询的like怎么写?"></a>10.模糊查询的like怎么写?</h2><table>
<thead>
<tr>
<th>模糊模式</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>LIKE &#39;abc%&#39;</code></td>
<td>匹配以 “abc” 开头的字符串</td>
<td>“abc123”、“abcd”</td>
</tr>
<tr>
<td><code>LIKE &#39;%abc&#39;</code></td>
<td>匹配以 “abc” 结尾的字符串</td>
<td>“123abc”、“xyzabc”</td>
</tr>
<tr>
<td><code>LIKE &#39;%abc%&#39;</code></td>
<td>匹配包含 “abc” 的字符串</td>
<td>“123abc456”、“abccc”</td>
</tr>
<tr>
<td><code>LIKE &#39;_abc_&#39;</code></td>
<td>匹配中间有 “abc” 且两边各有一个字符的字符串</td>
<td>“xabcx”</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>💡 若使用 <code>%</code> 前缀，索引失效。<br> 优化：使用 <strong>前缀匹配</strong> 或 <strong>全文索引（MySQL 5.6+）</strong>。</p>
<h2 id="11-Spring-的7种事务传播行为"><a href="#11-Spring-的7种事务传播行为" class="headerlink" title="11.Spring 的7种事务传播行为"></a>11.Spring 的7种事务传播行为</h2><p>当一个事务方法被另一个事务方法调用时，<strong>事务应该如何传播</strong>（即：是否共用当前事务、是否新建事务、是否挂起等）。</p>
<p>Spring 在底层通过 <strong>AOP 拦截事务方法</strong>，在调用前后通过 <code>TransactionInterceptor</code> 控制事务边界。<br> 每次调用一个带事务注解的方法时，Spring 会：</p>
<ol>
<li><p>检查当前线程是否已存在事务；</p>
</li>
<li><p>根据传播行为（Propagation）判断：</p>
<ul>
<li>是加入当前事务；</li>
<li>还是新建一个事务；</li>
<li>还是挂起当前事务；</li>
<li>还是抛异常终止。</li>
</ul>
<table>
<thead>
<tr>
<th>编号</th>
<th>传播行为</th>
<th>含义</th>
<th>是否复用当前事务</th>
<th>是否创建新事务</th>
<th>当前无事务是否创建</th>
<th>常见场景</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>REQUIRED</strong>（默认）</td>
<td>有事务就加入，没有就新建</td>
<td>✅</td>
<td>✅（无事务时）</td>
<td>✅</td>
<td>常用，默认行为</td>
</tr>
<tr>
<td>2</td>
<td><strong>REQUIRES_NEW</strong></td>
<td>每次都新建事务，挂起外部事务</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>独立事务，如日志记录</td>
</tr>
<tr>
<td>3</td>
<td><strong>SUPPORTS</strong></td>
<td>有事务就加入，没有就非事务执行</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>可选事务逻辑</td>
</tr>
<tr>
<td>4</td>
<td><strong>NOT_SUPPORTED</strong></td>
<td>如果有事务，则挂起当前事务</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>执行非事务逻辑，如大批量查询</td>
</tr>
<tr>
<td>5</td>
<td><strong>MANDATORY</strong></td>
<td>必须存在事务，否则抛异常</td>
<td>✅</td>
<td>❌</td>
<td>❌（抛异常）</td>
<td>子方法强依赖上层事务</td>
</tr>
<tr>
<td>6</td>
<td><strong>NEVER</strong></td>
<td>不允许存在事务，否则抛异常</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>严格非事务环境</td>
</tr>
<tr>
<td>7</td>
<td><strong>NESTED</strong></td>
<td>嵌套事务，外层回滚时一起回滚，内层可独立回滚</td>
<td>✅（外层事务中）</td>
<td>✅（保存点）</td>
<td>✅</td>
<td>复杂业务场景，分段回滚</td>
</tr>
</tbody></table>
</li>
</ol>
<p>事务失效：</p>
<ul>
<li>事务方法不是 public。非 public（如 private、protected、default）不会被代理拦截。</li>
<li>同类方法内部调用导致事务失效。Spring 事务是通过代理实现的，<strong>自调用不会触发代理逻辑</strong>。</li>
<li>异常被捕获导致事务不回滚。 Spring 默认只在 <strong>RuntimeException 或 Error</strong> 时回滚。如果抛出的是受检异常（Checked Exception），默认不会回滚。</li>
<li>数据源未被 Spring 管理。事务管理器必须基于同一个 Spring 容器内的数据源，否则事务不会生效。</li>
<li>多线程环境中事务失效。事务是基于 <strong>ThreadLocal</strong> 绑定的，多个线程不共享事务上下文。</li>
<li>事务传播属性设置不合适。比如外层没有事务，而内层方法设置了 <code>REQUIRES_NEW</code> 或 <code>SUPPORTS</code>，会导致预期外的事务行为。</li>
</ul>
<h2 id="12-Transactional-5个属性"><a href="#12-Transactional-5个属性" class="headerlink" title="12.@Transactional 5个属性"></a>12.@Transactional 5个属性</h2><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>propagation</code></td>
<td>事务传播行为</td>
</tr>
<tr>
<td><code>isolation</code></td>
<td>隔离级别</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>超时时间。事务执行的最长时间（秒），超时后会强制回滚。</td>
</tr>
<tr>
<td><code>readOnly</code></td>
<td>是否只读。优化数据库访问性能，声明该事务不涉及写操作。</td>
</tr>
<tr>
<td><code>rollbackFor</code></td>
<td>指定回滚异常类型</td>
</tr>
</tbody></table>
<h2 id="13-为什么需要预编译"><a href="#13-为什么需要预编译" class="headerlink" title="13.为什么需要预编译"></a>13.为什么需要预编译</h2><p>在 SQL 执行前，先由数据库服务器对 SQL 模板进行 <strong>编译与优化</strong>，之后只需绑定参数即可重复执行，而无需重新编译。</p>
<p>防止 SQL 注入攻击（安全性）</p>
<h4 id="❌-非预编译方式（Statement）："><a href="#❌-非预编译方式（Statement）：" class="headerlink" title="❌ 非预编译方式（Statement）："></a>❌ 非预编译方式（Statement）：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String sql = &quot;SELECT * FROM user WHERE username = &#x27;&quot; + name + &quot;&#x27; AND password = &#x27;&quot; + pwd + &quot;&#x27;&quot;;</span><br></pre></td></tr></table></figure>

<p>用户输入：<code>name=Tom&#39; OR &#39;1&#39;=&#39;1</code><br> 最终 SQL：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM user WHERE username=&#x27;Tom&#x27; OR &#x27;1&#x27;=&#x27;1&#x27; AND password=&#x27;&#x27;;</span><br></pre></td></tr></table></figure>

<p>JDBC 使用 <code>PreparedStatement</code> 预编译 SQL，提高性能与安全性。</p>
<h3 id="✅-优点："><a href="#✅-优点：" class="headerlink" title="✅ 优点："></a>✅ 优点：</h3><ul>
<li>减少 SQL 解析开销</li>
<li>防止 SQL 注入</li>
<li>批量执行优化</li>
</ul>
<p>💡 MyBatis 内部就是通过 <code>PreparedStatementHandler</code> 实现预编译。</p>
<h2 id="14-MQ-有哪些使用场景-掌握"><a href="#14-MQ-有哪些使用场景-掌握" class="headerlink" title="14.MQ 有哪些使用场景?(掌握)"></a>14.MQ 有哪些使用场景?(掌握)</h2><p>**消息队列（Message Queue, MQ）**是一种异步通信中间件，用于在**系统之间解耦、削峰、异步处理、保证可靠传输**。</p>
<p>生产者（Producer）把消息发送到队列中，消费者（Consumer）异步地从队列中获取消息执行操作。</p>
<p>常见的 MQ 产品包括：</p>
<ul>
<li><p><strong>RabbitMQ</strong>（基于 AMQP 协议，可靠性强）</p>
</li>
<li><p><strong>Kafka</strong>（高吞吐、适合日志和大数据）</p>
</li>
<li><p><strong>RocketMQ</strong>（阿里开源，支持事务消息）</p>
</li>
<li><p><strong>ActiveMQ</strong>（老牌消息中间件）</p>
<h2 id="为什么需要-MQ（解决什么问题）"><a href="#为什么需要-MQ（解决什么问题）" class="headerlink" title="为什么需要 MQ（解决什么问题）"></a>为什么需要 MQ（解决什么问题）</h2><p>MQ 主要解决三类问题：</p>
<h3 id="1️⃣-解耦（Decoupling）"><a href="#1️⃣-解耦（Decoupling）" class="headerlink" title="1️⃣ 解耦（Decoupling）"></a>1️⃣ 解耦（Decoupling）</h3><ul>
<li><strong>场景：</strong> 订单系统 → 库存系统 → 积分系统 → 通知系统<br>如果强耦合，当积分或通知模块挂掉，整个链路都出问题。</li>
<li><strong>解决：</strong> 订单模块只需发消息到 MQ，后续系统异步消费，不必强依赖。</li>
<li><strong>好处：</strong> 低耦合、可扩展（只需增加消费者）。</li>
</ul>
<h3 id="2️⃣-异步（Asynchronous）"><a href="#2️⃣-异步（Asynchronous）" class="headerlink" title="2️⃣ 异步（Asynchronous）"></a>2️⃣ 异步（Asynchronous）</h3><ul>
<li><strong>场景：</strong> 用户下单 → 发短信、发邮件、记录日志、推送积分。</li>
<li><strong>问题：</strong> 这些操作不影响主流程，但耗时长。</li>
<li><strong>解决：</strong> 把这些操作通过 MQ 异步处理，主线程立刻响应，提高响应速度。</li>
</ul>
<h3 id="3️⃣-削峰（Peak-Shaving）"><a href="#3️⃣-削峰（Peak-Shaving）" class="headerlink" title="3️⃣ 削峰（Peak Shaving）"></a>3️⃣ 削峰（Peak Shaving）</h3><ul>
<li><strong>场景：</strong> 秒杀、大促、抢红包场景下流量瞬间暴增。</li>
<li><strong>问题：</strong> 如果请求直打数据库，可能导致 DB 崩溃。</li>
<li><strong>解决：</strong> MQ 作为缓冲层，生产者写入消息，消费者按能力消费，系统更稳。</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>场景</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>异步解耦</td>
<td>下单后异步发短信、邮件</td>
</tr>
<tr>
<td>流量削峰</td>
<td>秒杀、抢购场景</td>
</tr>
<tr>
<td>日志收集</td>
<td>ELK、埋点上报</td>
</tr>
<tr>
<td>分布式事务</td>
<td>通过 MQ 最终一致性</td>
</tr>
<tr>
<td>延迟任务</td>
<td>订单超时取消</td>
</tr>
</tbody></table>
<h3 id="项目实践（结合经验）"><a href="#项目实践（结合经验）" class="headerlink" title="项目实践（结合经验）"></a>项目实践（结合经验）</h3><p>比如在我的商城项目中：</p>
<blockquote>
<p>用户下单后，我们使用 <strong>RocketMQ</strong> 实现了异步解耦。<br>订单服务只负责生成订单，然后发送 “订单创建成功” 消息。<br>库存服务、积分服务、消息通知服务 分别订阅该 Topic 进行处理。</p>
<ul>
<li>避免了服务间强依赖；</li>
<li>降低了数据库压力；</li>
<li>提高了下单接口的响应速度。</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>面试官追问</th>
<th>回答要点</th>
</tr>
</thead>
<tbody><tr>
<td>消息重复消费怎么办？</td>
<td>设计幂等性，如唯一消息ID或状态表。</td>
</tr>
<tr>
<td>消息丢失怎么办？</td>
<td>开启持久化、ACK 确认机制、重试机制。</td>
</tr>
<tr>
<td>消息顺序怎么保证？</td>
<td>按业务 key 分区 + 单线程消费。</td>
</tr>
<tr>
<td>如何处理消费失败？</td>
<td>重试机制 + 死信队列（DLQ）。</td>
</tr>
<tr>
<td>事务消息原理？</td>
<td>本地事务 + 消息半提交 + 回查机制。</td>
</tr>
</tbody></table>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/07/QVWvrnAsuGxelbS.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/07/QVWvrnAsuGxelbS.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">北川</div><div class="post-copyright__author_desc">Believe in yourself</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://gukeyang.github.io/posts/69be1e2f.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://gukeyang.github.io/posts/69be1e2f.html')">1022面试题</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/./img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/./img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wecaht/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://gukeyang.github.io/posts/69be1e2f.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=1022面试题&amp;url=https://gukeyang.github.io/posts/69be1e2f.html&amp;pic=https://s2.loli.net/2025/10/23/pH7DOX5rqdLCk4b.jpg?_r_=a6fd3437-28f4-cb41-7271-bc60ac64be0a" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gukeyang.github.io" target="_blank">北川的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%AF%8F%E6%97%A5%E9%9D%A2%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>每日面试<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2025/10/23/g4UkwyDri9BWZtE.jpg?_r_=5e33e3d7-4df9-4154-3103-a0a492836fe2" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/71adb096.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/wfbr2eNcL1VvXIn.png?_r_=0460ecbd-a85a-8e5a-799c-72a40f2599a6" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">函数</div></div></a></div><div class="next-post pull-right"><a href="/posts/ac61cbee.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/SurYK9kV8bRd2Ll.jpg?_r_=cc0abf58-7ab6-1e20-98bd-cb430ef2037d" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">电商平台中订单未支付过期如何实现自动关单</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/867c7511.html" title="1023面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/SurYK9kV8bRd2Ll.jpg?_r_=5ab12cb6-24e9-2c96-0aa4-328c5535dee9" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-23</div><div class="title">1023面试题</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/11/07/QVWvrnAsuGxelbS.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zc998800/cdn/face/gif/m17.gif" ait="status"/></div></div><div class="author-info__description">路慢其修远兮 吾将上下而求索</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">北川</h1><div class="author-info__desc">Believe in yourself</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/gukeyang" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1542898061" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://s2.loli.net/2023/10/19/vNio4QGBSX9x5lO.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AF%8F%E6%97%A5%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">每日面试题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%BC%9A%E5%A4%B1%E6%95%88"><span class="toc-number">1.1.</span> <span class="toc-text">1.索引哪些情况会失效?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-EXPLAIN-%E5%88%A4%E6%96%AD%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88%EF%BC%9A%E5%85%B3%E6%B3%A8-type-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.1.1.</span> <span class="toc-text">通过 EXPLAIN 判断索引是否有效：关注 type 字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%9A%E9%81%BF%E5%85%8D%E5%9B%9E%E8%A1%A8%EF%BC%8C%E4%BC%98%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%95%88%E7%8E%87"><span class="toc-number">1.1.2.</span> <span class="toc-text">覆盖索引：避免回表，优化查询效率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%EF%BC%88ICP%EF%BC%8CIndex-Condition-Pushdown%EF%BC%89%EF%BC%9A%E5%87%8F%E5%B0%91%E5%9B%9E%E8%A1%A8%E6%AC%A1%E6%95%B0"><span class="toc-number">1.1.3.</span> <span class="toc-text">索引下推（ICP，Index Condition Pushdown）：减少回表次数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-final%E3%80%81finalize%E3%80%81finally%E4%B8%89%E8%80%85%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">1.2.</span> <span class="toc-text">2.final、finalize、finally三者的不同?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-java%E4%B8%AD%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="toc-number">1.3.</span> <span class="toc-text">3.java中深拷贝和浅拷贝?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B5%85%E6%8B%B7%E8%B4%9D%EF%BC%88Shallow-Copy%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. 浅拷贝（Shallow Copy）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">定义：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">实现方式：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%B1%E6%8B%B7%E8%B4%9D%EF%BC%88Deep-Copy%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. 深拷贝（Deep Copy）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%EF%BC%9A-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">定义：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%EF%BC%9A-1"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">实现方式：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%B0%88%E4%B8%80%E4%B8%8B%E4%BD%A0%E5%AF%B9MyBatis%E7%9A%84%E8%AE%A4%E8%AF%86"><span class="toc-number">1.4.</span> <span class="toc-text">4.谈一下你对MyBatis的认识?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">缓存机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.4.2.</span> <span class="toc-text">核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9A%99%EF%B8%8F-%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.4.3.</span> <span class="toc-text">⚙️ 原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.4.</span> <span class="toc-text">MyBatis 整体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.5.</span> <span class="toc-text">MyBatis 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.6.</span> <span class="toc-text">MyBatis 缓存原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%8A%A8%E6%80%81SQL%E7%9A%84%E4%BD%9C%E7%94%A8%E5%92%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">5.动态SQL的作用和原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%8A%A8%E6%80%81-SQL-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">一、动态 SQL 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.2.</span> <span class="toc-text">原理总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-get%E5%92%8Cpost%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.6.</span> <span class="toc-text">6.get和post的区别?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-spring%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.7.</span> <span class="toc-text">7.spring拦截器的执行顺序?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.7.1.</span> <span class="toc-text">✅ 执行流程：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E9%A1%BA%E5%BA%8F%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">1.7.2.</span> <span class="toc-text">✅ 顺序规则：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%88Interceptor%EF%BC%89"><span class="toc-number">1.7.3.</span> <span class="toc-text">1. 拦截器（Interceptor）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">1.1. 概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%B7%A5%E4%BD%9C%E6%97%B6%E6%9C%BA"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">1.2. 工作时机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">1.3. 执行顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">1.4. 实现方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">1.5. 应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%88Filter%EF%BC%89"><span class="toc-number">1.7.4.</span> <span class="toc-text">2. 过滤器（Filter）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">2.1. 概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%B7%A5%E4%BD%9C%E6%97%B6%E6%9C%BA"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">2.2. 工作时机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">2.3. 执行顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.4.4.</span> <span class="toc-text">2.4. 实现方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E4%B8%8E%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.7.5.</span> <span class="toc-text">拦截器与过滤器的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.</span> <span class="toc-text">8.后端验证注解?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Valid-%E5%92%8C-Validated"><span class="toc-number">1.8.0.1.</span> <span class="toc-text">@Valid 和 @Validated</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84-Spring-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.8.1.</span> <span class="toc-text">常见的 Spring 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%85%A8%E5%B1%80%E9%AA%8C%E8%AF%81"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">启用全局验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">全局异常处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">1.9.</span> <span class="toc-text">9.如何保证消息的可靠性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%A0%B8%E5%BF%83%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-number">1.9.1.</span> <span class="toc-text">✅ 核心思路：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%82%E7%AD%89%E6%80%A7%E4%BF%9D%E8%AF%81"><span class="toc-number">1.9.2.</span> <span class="toc-text">幂等性保证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%82%E7%AD%89%E6%80%A7%E5%AE%9A%E4%B9%89"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">幂等性定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">实现幂等性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%8A%A5%E8%AD%A6"><span class="toc-number">1.9.3.</span> <span class="toc-text">监控与报警</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E7%9A%84like%E6%80%8E%E4%B9%88%E5%86%99"><span class="toc-number">1.10.</span> <span class="toc-text">10.模糊查询的like怎么写?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Spring-%E7%9A%847%E7%A7%8D%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-number">1.11.</span> <span class="toc-text">11.Spring 的7种事务传播行为</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-Transactional-5%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="toc-number">1.12.</span> <span class="toc-text">12.@Transactional 5个属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-number">1.13.</span> <span class="toc-text">13.为什么需要预编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E9%9D%9E%E9%A2%84%E7%BC%96%E8%AF%91%E6%96%B9%E5%BC%8F%EF%BC%88Statement%EF%BC%89%EF%BC%9A"><span class="toc-number">1.13.0.1.</span> <span class="toc-text">❌ 非预编译方式（Statement）：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-number">1.13.1.</span> <span class="toc-text">✅ 优点：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-MQ-%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-%E6%8E%8C%E6%8F%A1"><span class="toc-number">1.14.</span> <span class="toc-text">14.MQ 有哪些使用场景?(掌握)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-MQ%EF%BC%88%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%89"><span class="toc-number">1.15.</span> <span class="toc-text">为什么需要 MQ（解决什么问题）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E8%A7%A3%E8%80%A6%EF%BC%88Decoupling%EF%BC%89"><span class="toc-number">1.15.1.</span> <span class="toc-text">1️⃣ 解耦（Decoupling）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E5%BC%82%E6%AD%A5%EF%BC%88Asynchronous%EF%BC%89"><span class="toc-number">1.15.2.</span> <span class="toc-text">2️⃣ 异步（Asynchronous）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E5%89%8A%E5%B3%B0%EF%BC%88Peak-Shaving%EF%BC%89"><span class="toc-number">1.15.3.</span> <span class="toc-text">3️⃣ 削峰（Peak Shaving）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5%EF%BC%88%E7%BB%93%E5%90%88%E7%BB%8F%E9%AA%8C%EF%BC%89"><span class="toc-number">1.15.4.</span> <span class="toc-text">项目实践（结合经验）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/aff6963e.html" title="如何解决高并发下的库存抢购超卖少买问题？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/g4UkwyDri9BWZtE.jpg?_r_=5e33e3d7-4df9-4154-3103-a0a492836fe2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何解决高并发下的库存抢购超卖少买问题？"/></a><div class="content"><a class="title" href="/posts/aff6963e.html" title="如何解决高并发下的库存抢购超卖少买问题？">如何解决高并发下的库存抢购超卖少买问题？</a><time datetime="2025-10-23T04:24:36.000Z" title="发表于 2025-10-23 12:24:36">2025-10-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/867c7511.html" title="1023面试题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/SurYK9kV8bRd2Ll.jpg?_r_=5ab12cb6-24e9-2c96-0aa4-328c5535dee9" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1023面试题"/></a><div class="content"><a class="title" href="/posts/867c7511.html" title="1023面试题">1023面试题</a><time datetime="2025-10-23T04:23:36.000Z" title="发表于 2025-10-23 12:23:36">2025-10-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/daef90fc.html" title="抽象类和接口"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/pH7DOX5rqdLCk4b.jpg?_r_=8852ff95-2fbc-a374-7fe7-6b2e2ca6af68" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="抽象类和接口"/></a><div class="content"><a class="title" href="/posts/daef90fc.html" title="抽象类和接口">抽象类和接口</a><time datetime="2025-10-22T06:56:35.000Z" title="发表于 2025-10-22 14:56:35">2025-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ac61cbee.html" title="电商平台中订单未支付过期如何实现自动关单"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/SurYK9kV8bRd2Ll.jpg?_r_=cc0abf58-7ab6-1e20-98bd-cb430ef2037d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="电商平台中订单未支付过期如何实现自动关单"/></a><div class="content"><a class="title" href="/posts/ac61cbee.html" title="电商平台中订单未支付过期如何实现自动关单">电商平台中订单未支付过期如何实现自动关单</a><time datetime="2025-10-21T17:41:03.000Z" title="发表于 2025-10-22 01:41:03">2025-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/69be1e2f.html" title="1022面试题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2025/10/23/pH7DOX5rqdLCk4b.jpg?_r_=a6fd3437-28f4-cb41-7271-bc60ac64be0a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1022面试题"/></a><div class="content"><a class="title" href="/posts/69be1e2f.html" title="1022面试题">1022面试题</a><time datetime="2025-10-21T17:23:36.000Z" title="发表于 2025-10-22 01:23:36">2025-10-22</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="undefined" alt="undefined" title="undefined"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="北川" target="_blank">北川</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java%E6%95%99%E7%A8%8B/" style="font-size: 0.88rem;">java教程<sup>1</sup></a><a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 0.88rem;">函数<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 0.88rem;">反射<sup>1</sup></a><a href="/tags/%E5%A4%8D%E4%B9%A0/" style="font-size: 0.88rem;">复习<sup>1</sup></a><a href="/tags/%E5%A4%8D%E4%B9%A0-%E5%8F%98%E9%87%8F/" style="font-size: 0.88rem;">复习 变量<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">工具<sup>1</sup></a><a href="/tags/%E6%83%85%E6%84%9F/" style="font-size: 0.88rem;">情感<sup>1</sup></a><a href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E6%8E%A5%E5%8F%A3/" style="font-size: 0.88rem;">抽象类 接口<sup>1</sup></a><a href="/tags/%E6%AF%8F%E6%97%A5%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">每日面试<sup>2</sup></a><a href="/tags/%E7%94%B5%E5%95%86-%E8%AE%A2%E5%8D%95/" style="font-size: 0.88rem;">电商,订单<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%B6%85%E5%8D%96-%E5%BA%93%E5%AD%98/" style="font-size: 0.88rem;">超卖 , 库存<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8152976493&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 北川 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      img.src = "";
      img.title = "";
      img.alt = "";

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '4GK2IcRZ0PX28gP4kGsW08qs-gzGzoHsz',
      appKey: 'TjKeHNK7GJrGTYuKYzGzh8yg',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://4GK2IcRZ.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '4GK2IcRZ0PX28gP4kGsW08qs-gzGzoHsz',
        "X-LC-Key": 'TjKeHNK7GJrGTYuKYzGzh8yg',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="//code.tidio.co/4nifo6zdbrmyjsngh2yzxwbnlhrvshrf.js" async="async"></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    let isShow = false
    const close = () => {
      window.tidioChatApi.hide()
      isShow = false
    }
    
    const open = () => {
      window.tidioChatApi.open()
      window.tidioChatApi.show()
      isShow = true
    }

    const onTidioChatApiReady = () => {
      window.tidioChatApi.hide()
      window.tidioChatApi.on("close", close)
    }
    if (window.tidioChatApi) {
      window.tidioChatApi.on("ready", onTidioChatApiReady)
    } else {
      document.addEventListener("tidioChat-ready", onTidioChatApiReady)
    }

    window.chatBtnFn = () => {
      if (!window.tidioChatApi) return
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        window.tidioChatApi && window.tidioChatApi.hide()
      },
      show: () => {
        window.tidioChatApi && window.tidioChatApi.show()
      }
    }
  }
})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>